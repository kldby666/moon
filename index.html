<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­ç§‹çƒŸèŠ±ç‰¹æ•ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* æœˆäº®æ ·å¼ */
        .moon-container {
            position: fixed;
            top: 3%;
            left: 1%;
            z-index: 10;
            pointer-events: none;
            transition: transform 0.5s ease;
        }
        .moon {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #fffbeb;
            box-shadow: 0 0 60px 30px rgba(255, 255, 240, 0.5);
            position: relative;
            animation: float 20s ease-in-out infinite;
            cursor: pointer;
            pointer-events: auto;
        }
        .moon-spot1 {
            position: absolute;
            top: 30%;
            left: 20%;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #fef3c7;
            opacity: 0.7;
        }
        .moon-spot2 {
            position: absolute;
            top: 60%;
            right: 25%;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: #fef3c7;
            opacity: 0.6;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        /* æ±Ÿå—å°é•‡å‰ªå½± */
        .town-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%;
            z-index: 1;
            background: linear-gradient(to top, #1a202c 80%, transparent 100%);
            pointer-events: none;
        }
        .town-silhouette {
            width: 100%;
            height: 100%;
        }

        /* æ»šåŠ¨æ–‡å­—åŠ¨ç”» */
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .animate-scroll {
            animation: scroll 30s linear infinite;
        }

        .text-shadow {
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }
        
        /* ç¯ç¬¼æ ·å¼ */
        .lantern {
            position: fixed;
            width: 60px;
            height: 80px;
            background-color: #e53e3e;
            border-radius: 30px;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            z-index: 5;
            pointer-events: auto;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fef08a;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
        }
        .lantern::before {
            content: '';
            position: absolute;
            top: -10px;
            width: 20px;
            height: 10px;
            background-color: #e53e3e;
            border-radius: 5px 5px 0 0;
        }
        .lantern::after {
            content: '';
            position: absolute;
            bottom: -10px;
            width: 20px;
            height: 10px;
            background-color: #e53e3e;
            border-radius: 0 0 5px 5px;
        }
        
        /* æœˆé¥¼æ ·å¼ */
        .mooncake {
            position: fixed;
            width: 50px;
            height: 50px;
            background-color: #d97706;
            border-radius: 50%;
            z-index: 5;
            pointer-events: auto;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(217, 119, 6, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fef3c7;
            font-size: 12px;
            text-align: center;
            line-height: 1.2;
            transition: all 0.3s;
        }
        .mooncake::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8) 0%, transparent 70%);
            pointer-events: none;
        }
        
        /* å…”å­æ ·å¼ - ä¿®æ”¹ä¸ºå›¾ç‰‡å®¹å™¨ */
        .rabbit {
            position: fixed;
            width: 80px;
            height: 80px;
            z-index: 5;
            pointer-events: auto;
            cursor: pointer;
            transition: all 0.3s;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50%;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        
        /* ç®€åŒ–åçš„æ§åˆ¶é¢æ¿ */
        .control-panel {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 10px;
            color: white;
            z-index: 100;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 14px;
        }
        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            text-align: center;
        }
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .control-btn.active {
            background: rgba(229, 62, 62, 0.5);
            border-color: rgba(229, 62, 62, 0.5);
        }
        
        /* é£˜è½çš„æ¡‚èŠ±æ•ˆæœ */
        .osmanthus {
            position: absolute;
            color: #f59e0b;
            font-size: 16px;
            pointer-events: none;
            z-index: 2;
            animation: falling linear infinite;
        }
        
        @keyframes falling {
            0% {
                transform: translateY(-10px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh + 20px)) rotate(360deg);
                opacity: 0;
            }
        }

        /* éŸ³ä¹æ’­æ”¾æŒ‰é’®æ ·å¼ */
        #music-play-button {
            position: fixed;
            top: 40px;
            right: 10px;
            padding: 12px 24px;
            background-color: rgba(0, 0, 0, 0.6);
            color: #ffffff;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s, transform 0.3s;
            z-index: 100;
        }

        #music-play-button:hover {
            background-color: rgba(0, 0, 0, 0.8);
            transform: scale(1.05);
        }

        #music-play-button:active {
            transform: scale(0.95);
        }

        /* æ·»åŠ æ’­æ”¾å›¾æ ‡ */
        .music-play-icon {
            width: 0; 
            height: 0; 
            border-left: 12px solid #ffffff;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            margin-right: 8px;
        }
    </style>
</head>
<body class="bg-black overflow-hidden h-screen m-0 p-0">
    <!-- æ·»åŠ èƒŒæ™¯éŸ³ä¹ -->
    <audio id="background-music" loop preload="auto">
        <source src="https://m801.music.126.net/20250918213212/7c260d759c7142860b51b0fa1232e29c/jdymusic/obj/wo3DlMOGwrbDjj7DisKw/36268385962/606a/f052/0ed4/c98befada0bbda64959b10b6cfd4f566.mp3?vuutv=uZPTFlWjvhO4QA1+1PROZv6Ys6YB0Q0Jb30AeTSoAcBp7v6ud07CDRHvTR+IaXOSM5DyjCSVHep4b7FvFanwoL3dDfOB/GWIzlTmJ19WWP7BDsfbZzVkB76b2yfvJLSvf0RVr5QC5YDJJHMy/irVsO0a+si9mgCZafneksMc9nchxRMpKhtFo4vDYfTahks+eyZCdBg5bgP8oFupbsQR/+BH/+obh7WZvJO0vCkkPN66nEAnxxr3COmJgFwTU7sni4x6wikmbHfnw5GXLwUMri5/XSUAFT/qv+Cgo7ImDW37Qbv67V8AKqO5/bC81/+jgioqBmCQfKY/IvkxK2LfE0fad4IVfjq0wD+eCrXlum+RMXt+o9hq17muz8tkqa15&cdntag=bWFyaz1vc193ZWIscXVhbGl0eV9zdGFuZGFyZA" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
    </audio>
    
    <!-- éŸ³ä¹æ’­æ”¾æŒ‰é’® -->
    <button id="music-play-button">
        <div class="music-play-icon"></div>
        æ’­æ”¾éŸ³ä¹
    </button>
    
    <!-- ç”»å¸ƒæ”¾åœ¨æœ€åº•å±‚ä½†èƒ½æ¥æ”¶ç‚¹å‡» -->
    <canvas id="fireworksCanvas" class="absolute inset-0 w-full h-full z-2"></canvas>
    
    <!-- å·¦ä¸Šè§’çš„æœˆäº® -->
    <div class="moon-container" id="moonContainer">
        <div class="moon" id="moon">
            <div class="moon-spot1"></div>
            <div class="moon-spot2"></div>
        </div>
    </div>
    
    <!-- ç¯ç¬¼å…ƒç´  -->
    <div class="lantern" style="top: 15%; right: 15%;">ç¦</div>
    <div class="lantern" style="top: 25%; left: 15%;">ç¦„</div>
    
    <!-- æœˆé¥¼å…ƒç´  -->
    <div class="mooncake" style="bottom: 25%; right: 20%;">äº”ä»</div>
    <div class="mooncake" style="bottom: 30%; left: 20%;">è±†æ²™</div>
    
    <!-- ç‰å…”å…ƒç´  - ä¿®æ”¹ä¸ºå›¾ç‰‡å®¹å™¨ -->
    <div class="rabbit" id="rabbit" style="background-image: url('https://img0v0.shiguang520.com/img/yutu.png')">
        <!-- è¿™é‡Œå¯ä»¥æ”¾ç½®è‡ªå®šä¹‰å›¾ç‰‡ -->
    </div>
    
    <!-- åº•éƒ¨æ±Ÿå—å°é•‡å‰ªå½±ï¼ˆåœ¨çƒŸèŠ±åé¢ï¼‰ -->
    <div class="town-container">
        <svg class="town-silhouette" viewBox="0 0 1000 300" preserveAspectRatio="xMidYMid slice">
            <!-- æ°´é¢ -->
            <rect x="0" y="220" width="1000" height="80" fill="#1a202c" />
            <rect x="0" y="220" width="1000" height="40" fill="rgba(30, 40, 60, 0.3)" />
            
            <!-- å»ºç­‘å’Œæ¡¥æ¢å‰ªå½± -->
            <path d="M0,220 L50,180 L80,200 L120,160 L150,190 L200,150 L250,180 L300,160 L350,190 L400,150 L450,180 L500,160 L550,190 L600,150 L650,180 L700,160 L750,190 L800,150 L850,180 L900,160 L950,190 L1000,170 L1000,220 Z" fill="#111827" />
            <rect x="100" y="160" width="60" height="60" fill="#111827" />
            <rect x="180" y="140" width="80" height="80" fill="#111827" />
            <rect x="300" y="150" width="70" height="70" fill="#111827" />
            <rect x="420" y="130" width="90" height="90" fill="#111827" />
            <rect x="550" y="160" width="60" height="60" fill="#111827" />
            <rect x="650" y="140" width="80" height="80" fill="#111827" />
            <rect x="800" y="150" width="70" height="70" fill="#111827" />
            <path d="M350,220 L400,190 L450,220" stroke="#111827" stroke-width="15" fill="none" />
            
            <!-- ç¯å…‰æ•ˆæœ -->
            <circle cx="130" cy="190" r="3" fill="#fde68a" opacity="0.7" />
            <circle cx="220" cy="170" r="3" fill="#fde68a" opacity="0.7" />
            <circle cx="460" cy="160" r="3" fill="#fde68a" opacity="0.7" />
            <circle cx="690" cy="170" r="3" fill="#fde68a" opacity="0.7" />
            <circle cx="830" cy="180" r="3" fill="#fde68a" opacity="0.7" />
            <line x1="130" y1="225" x2="130" y2="245" stroke="#fde68a" stroke-width="2" opacity="0.3" />
            <line x1="220" y1="225" x2="220" y2="245" stroke="#fde68a" stroke-width="2" opacity="0.3" />
            <line x1="460" y1="225" x2="460" y2="245" stroke="#fde68a" stroke-width="2" opacity="0.3" />
            
            <!-- å°èˆ¹ -->
            <path d="M700,240 Q750,230 800,240 Q790,250 750,250 Q720,250 700,240" fill="#111827" />
            <path d="M750,230 Q760,220 770,230" stroke="#fde68a" stroke-width="2" fill="none" />
        </svg>
    </div>
    
    <!-- é¡¶éƒ¨æ–‡å­— -->
    <div class="fixed top-10 left-1/2 transform -translate-x-1/2 text-white text-center z-10 pointer-events-none">
        <h1 class="text-3xl md:text-5xl font-bold text-shadow">ä¸­ç§‹å¿«ä¹</h1>
        <p class="mt-2 text-lg md:text-xl">2025 Â· ä¸‡äº‹é¡ºé‚ </p>
    </div>
    
    <!-- æ»šåŠ¨æ–‡å­— -->
    <div class="fixed top-4 left-0 w-full overflow-hidden z-10 pointer-events-none">
        <div class="whitespace-nowrap animate-scroll text-white text-xl">
            ğŸŒ• èŠ±å¥½æœˆåœ† â¤ï¸ é˜–å®¶å›¢åœ† â¤ï¸ ä¸­ç§‹å®‰åº· â¤ï¸ å¹¸ç¦ç¾æ»¡ â¤ï¸ ä¸‡äº‹å¦‚æ„ â¤ï¸ ğŸŒ• 
            èŠ±å¥½æœˆåœ† â¤ï¸ é˜–å®¶å›¢åœ† â¤ï¸ ä¸­ç§‹å®‰åº· â¤ï¸ å¹¸ç¦ç¾æ»¡ â¤ï¸ ä¸‡äº‹å¦‚æ„ â¤ï¸ ğŸŒ•
        </div>
    </div>
    
    <!-- æç¤ºæ–‡å­— -->
    <div class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-center z-10 opacity-70 pointer-events-none">
        <p class="text-[clamp(1.2rem,3vw,2rem)] font-light mb-4">ç‚¹å‡»ä»»æ„å¤„ç‡ƒæ”¾çƒŸèŠ±</p>
        <p class="text-sm text-gray-300 mt-2">æ‹–åŠ¨æœˆäº®å¯æ”¹å˜ä½ç½® | ç‚¹å‡»ç¯ç¬¼æœ‰æƒŠå–œ | æŒ‰ç©ºæ ¼é”®è‡ªåŠ¨çƒŸèŠ±</p>
    </div>

    <!-- ç®€åŒ–åçš„æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <button class="control-btn" id="btnHeart">çˆ±å¿ƒçƒŸèŠ±</button>
        <button class="control-btn" id="btnAuto">è‡ªåŠ¨æ¨¡å¼</button>
        <button class="control-btn" id="btnOsmanthus">æ¡‚èŠ±é£˜è½</button>
    </div>

    <script>
        // çƒŸèŠ±æ ¸å¿ƒé€»è¾‘
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        
        // ç¡®ä¿ç”»å¸ƒå¤§å°æ­£ç¡®
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        let fireworks = [];
        let particles = [];
        let floatingTexts = [];
        let autoFireworks = true; // é»˜è®¤å¼€å¯è‡ªåŠ¨æ¨¡å¼
        let lastAutoFire = 0;
        let fireworkMode = 'random'; // 'random', 'heart'
        let isDraggingMoon = false;
        let moonOffsetX = 0;
        let moonOffsetY = 0;
        let osmanthusEnabled = false;
        let osmanthusInterval = null;
        
        // è·å–DOMå…ƒç´ 
        const moon = document.getElementById('moon');
        const moonContainer = document.getElementById('moonContainer');
        const btnHeart = document.getElementById('btnHeart');
        const btnAuto = document.getElementById('btnAuto');
        const btnOsmanthus = document.getElementById('btnOsmanthus');
        const rabbit = document.getElementById('rabbit');
        
        function random(min, max) {
            return Math.random() * (max - min) + min;
        }
        
        // çƒŸèŠ±ç±»
        class Firework {
            constructor(x, y, targetX, targetY, color) {
                this.x = x || random(50, canvas.width - 50);
                this.y = y || canvas.height;
                this.targetX = targetX || this.x;
                this.targetY = targetY || random(canvas.height * 0.3, canvas.height * 0.7);
                this.velocity = random(4, 6);
                this.gravity = 0.05;
                this.alpha = 1;
                this.color = color || {
                    r: Math.floor(random(150, 255)),
                    g: Math.floor(random(150, 255)),
                    b: Math.floor(random(150, 255))
                };
                this.reachedTarget = false;
                this.trail = [];
                this.sparkleIntensity = random(0.5, 1.5);
            }
            
            update() {
                const dx = this.targetX - this.x;
                const dy = this.targetY - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                const vx = (dx / distance) * this.velocity;
                const vy = (dy / distance) * this.velocity - this.gravity;
                
                this.x += vx;
                this.y += vy;
                
                this.trail.push({x: this.x, y: this.y, alpha: this.alpha});
                if (this.trail.length > 20) this.trail.shift();
                
                if (distance < this.velocity) {
                    this.reachedTarget = true;
                    this.explode();
                }
            }
            
            explode() {
                let particleCount = fireworkMode === 'heart' ? 150 : Math.floor(random(80, 120));
                
                if (fireworkMode === 'heart') {
                    const heartParticles = this.createHeartParticles();
                    particles = particles.concat(heartParticles);
                } else {
                    for (let i = 0; i < particleCount; i++) {
                        const angle = random(0, Math.PI * 2);
                        const speed = random(1, 6) * this.sparkleIntensity;
                        
                        particles.push(new Particle(
                            this.targetX, this.targetY,
                            Math.cos(angle) * speed,
                            Math.sin(angle) * speed,
                            this.color
                        ));
                    }
                }
                
                // æ·»åŠ æµ®åŠ¨æ–‡å­—
                const texts = ['ä¸­ç§‹å¿«ä¹', 'èŠ±å¥½æœˆåœ†', 'é˜–å®¶å›¢åœ†', 'å¹¸ç¦ç¾æ»¡', 'ä¸‡äº‹å¦‚æ„'];
                floatingTexts.push(new FloatingText(
                    this.targetX, this.targetY, 
                    texts[Math.floor(Math.random() * texts.length)],
                    this.color
                ));
            }
            
            createHeartParticles() {
                const heartParticles = [];
                const color = this.color;
                
                // å¿ƒå½¢æ›²çº¿å‚æ•°æ–¹ç¨‹
                for (let t = 0; t < Math.PI * 2; t += 0.05) {
                    const x = 16 * Math.pow(Math.sin(t), 3);
                    const y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                    
                    const scale = 2.5 * this.sparkleIntensity;
                    const vx = x * scale / 10;
                    const vy = y * scale / 10;
                    
                    heartParticles.push(new Particle(
                        this.targetX, this.targetY,
                        vx, vy,
                        color,
                        true // æ˜¯å½¢çŠ¶ç²’å­
                    ));
                }
                
                return heartParticles;
            }
            
            draw() {
                for (let i = 0; i < this.trail.length; i++) {
                    const point = this.trail[i];
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 1, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${point.alpha})`;
                    ctx.fill();
                    point.alpha *= 0.9;
                }
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${this.alpha})`;
                ctx.fill();
            }
        }
        
        // ç²’å­ç±»
        class Particle {
            constructor(x, y, vx, vy, color, isShapeParticle = false) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.gravity = isShapeParticle ? 0.02 : 0.06;
                this.friction = isShapeParticle ? 0.98 : 0.97;
                this.alpha = 1;
                this.color = color;
                this.radius = isShapeParticle ? random(1.5, 2.5) : random(1, 2.5);
                this.decay = isShapeParticle ? random(0.01, 0.02) : random(0.015, 0.03);
                this.isShapeParticle = isShapeParticle;
                this.sparkleIntensity = random(0.8, 1.2);
            }
            
            update() {
                this.vx *= this.friction;
                this.vy *= this.friction;
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.alpha -= this.decay;
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${this.alpha})`;
                ctx.fill();
                
                // æ·»åŠ å‘å…‰æ•ˆæœ
                if (this.isShapeParticle) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius * 3, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${this.alpha * 0.15})`;
                    ctx.fill();
                } else {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius * 2, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${this.alpha * 0.2})`;
                    ctx.fill();
                }
                
                // éšæœºé—ªçƒæ•ˆæœ
                if (Math.random() < 0.1 * this.sparkleIntensity) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius * 1.5, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha * 0.8})`;
                    ctx.fill();
                }
            }
            
            isAlive() {
                return this.alpha > 0;
            }
        }
        
        // æµ®åŠ¨æ–‡å­—ç±»
        class FloatingText {
            constructor(x, y, text, color) {
                this.x = x;
                this.y = y;
                this.text = text;
                this.alpha = 1;
                this.vy = -2;
                this.fontSize = random(16, 24);
                this.color = color || {
                    r: Math.floor(random(200, 255)),
                    g: Math.floor(random(200, 255)),
                    b: Math.floor(random(200, 255))
                };
                this.rotation = random(-5, 5);
                this.rotationSpeed = random(-0.5, 0.5);
            }
            
            update() {
                this.y += this.vy;
                this.alpha -= 0.02;
                this.vy *= 0.95;
                this.rotation += this.rotationSpeed;
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation * Math.PI / 180);
                ctx.font = `${this.fontSize}px "Microsoft YaHei", sans-serif`;
                ctx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${this.alpha})`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${this.alpha})`;
                ctx.shadowBlur = 10;
                ctx.fillText(this.text, 0, 0);
                ctx.restore();
            }
            
            isAlive() {
                return this.alpha > 0;
            }
        }
        
        // åˆ›å»ºçƒŸèŠ±å‡½æ•°
        function createFirework(x, y, text = '', color) {
            fireworks.push(new Firework(x, y, null, null, color));
            if (text) {
                floatingTexts.push(new FloatingText(x, y, text, color));
            }
        }
        
        // è‡ªåŠ¨çƒŸèŠ±å‡½æ•°
        function createAutoFirework() {
            const now = Date.now();
            if (now - lastAutoFire > random(200, 800)) {
                const x = random(50, canvas.width - 50);
                const y = random(canvas.height * 0.6, canvas.height * 0.95);
                createFirework(x, y);
                lastAutoFire = now;
            }
        }
        
        // åˆ›å»ºé£˜è½çš„æ¡‚èŠ±
        function createOsmanthus() {
            if (!osmanthusEnabled) return;
            
            const osmanthus = document.createElement('div');
            osmanthus.className = 'osmanthus';
            osmanthus.innerHTML = 'ğŸŒ¸';
            osmanthus.style.left = `${random(0, canvas.width)}px`;
            osmanthus.style.animationDuration = `${random(5, 15)}s`;
            osmanthus.style.animationDelay = `${random(0, 5)}s`;
            document.body.appendChild(osmanthus);
            
            // ç§»é™¤å®ŒæˆåŠ¨ç”»çš„å…ƒç´ 
            setTimeout(() => {
                osmanthus.remove();
            }, 15000);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            // åˆ›å»ºåŠé€æ˜é»‘è‰²èƒŒæ™¯ï¼Œå½¢æˆæ‹–å°¾æ•ˆæœ
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ›´æ–°å’Œç»˜åˆ¶çƒŸèŠ±
            for (let i = fireworks.length - 1; i >= 0; i--) {
                fireworks[i].update();
                fireworks[i].draw();
                if (fireworks[i].reachedTarget) fireworks.splice(i, 1);
            }
            
            // æ›´æ–°å’Œç»˜åˆ¶ç²’å­
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].draw();
                if (!particles[i].isAlive()) particles.splice(i, 1);
            }
            
            // æ›´æ–°å’Œç»˜åˆ¶æ–‡å­—
            for (let i = floatingTexts.length - 1; i >= 0; i--) {
                floatingTexts[i].update();
                floatingTexts[i].draw();
                if (!floatingTexts[i].isAlive()) floatingTexts.splice(i, 1);
            }
            
            // è‡ªåŠ¨çƒŸèŠ±
            if (autoFireworks) createAutoFirework();
            requestAnimationFrame(animate);
        }
        
        // æœˆäº®æ‹–æ‹½åŠŸèƒ½
        moon.addEventListener('mousedown', (e) => {
            isDraggingMoon = true;
            const rect = moonContainer.getBoundingClientRect();
            moonOffsetX = e.clientX - rect.left;
            moonOffsetY = e.clientY - rect.top;
            moonContainer.style.transition = 'none';
            e.preventDefault();
        });
        
        document.addEventListener('mousemove', (e) => {
            if (isDraggingMoon) {
                moonContainer.style.left = (e.clientX - moonOffsetX) + 'px';
                moonContainer.style.top = (e.clientY - moonOffsetY) + 'px';
            }
        });
        
        document.addEventListener('mouseup', () => {
            isDraggingMoon = false;
            moonContainer.style.transition = 'transform 0.5s ease';
        });
        
        // æœˆäº®ç‚¹å‡»äº‹ä»¶ - é‡Šæ”¾ç‰¹æ®ŠçƒŸèŠ±
        moon.addEventListener('click', (e) => {
            if (!isDraggingMoon) {
                const rect = moonContainer.getBoundingClientRect();
                const moonCenterX = rect.left + rect.width / 2;
                const moonCenterY = rect.top + rect.height / 2;
                
                // ä»æœˆäº®ä½ç½®å‘å°„çƒŸèŠ±
                createFirework(moonCenterX, moonCenterY);
                
                // æœˆäº®åŠ¨ç”»æ•ˆæœ
                moonContainer.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    moonContainer.style.transform = 'scale(1)';
                }, 300);
                
                e.stopPropagation();
            }
        });
        
        // ç¯ç¬¼ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.lantern').forEach(lantern => {
            lantern.addEventListener('click', (e) => {
                const rect = lantern.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                // ç¯ç¬¼åŠ¨ç”»
                lantern.style.transform = 'scale(1.2)';
                lantern.style.boxShadow = '0 0 40px rgba(255, 0, 0, 0.8)';
                setTimeout(() => {
                    lantern.style.transform = 'scale(1)';
                    lantern.style.boxShadow = '0 0 20px rgba(255, 0, 0, 0.5)';
                }, 300);
                
                // é‡Šæ”¾çˆ±å¿ƒçƒŸèŠ±
                const currentMode = fireworkMode;
                fireworkMode = 'heart';
                createFirework(centerX, centerY);
                fireworkMode = currentMode;
                
                e.stopPropagation();
            });
        });
        
        // æœˆé¥¼ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.mooncake').forEach(mooncake => {
            mooncake.addEventListener('click', (e) => {
                const rect = mooncake.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                // æœˆé¥¼åŠ¨ç”»
                mooncake.style.transform = 'scale(1.3) rotate(15deg)';
                mooncake.style.boxShadow = '0 0 30px rgba(217, 119, 6, 0.8)';
                setTimeout(() => {
                    mooncake.style.transform = 'scale(1) rotate(0)';
                    mooncake.style.boxShadow = '0 0 10px rgba(217, 119, 6, 0.5)';
                }, 300);
                
                // é‡Šæ”¾éšæœºçƒŸèŠ±
                createFirework(centerX, centerY, mooncake.textContent);
                
                e.stopPropagation();
            });
        });
        
        // å…”å­ç‚¹å‡»äº‹ä»¶
        rabbit.addEventListener('click', (e) => {
            const rect = rabbit.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // å…”å­åŠ¨ç”»
            rabbit.style.transform = 'translateX(-50%) scale(1.2)';
            setTimeout(() => {
                rabbit.style.transform = 'translateX(-50%) scale(1)';
            }, 300);
            
            // é‡Šæ”¾çƒŸèŠ±
            createFirework(centerX, centerY);
            
            e.stopPropagation();
        });
        
        // é¡µé¢ç‚¹å‡»äº‹ä»¶
        document.body.addEventListener('click', (e) => {
            const texts = ['èŠ±å¥½æœˆåœ†', 'é˜–å®¶å›¢åœ†', 'ä¸­ç§‹å®‰åº·', 'å¹¸ç¦ç¾æ»¡', 'ä¸‡äº‹å¦‚æ„'];
            const x = e.clientX;
            const y = e.clientY;
            
            createFirework(x, y, texts[Math.floor(Math.random() * texts.length)]);
        }, { capture: true });
        
        // ç©ºæ ¼é”®è‡ªåŠ¨çƒŸèŠ±
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                autoFireworks = !autoFireworks;
                updateButtonStates();
                
                if (autoFireworks) {
                    // ç«‹å³ç”Ÿæˆ3ä¸ªçƒŸèŠ±
                    for(let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            const x = random(50, canvas.width - 50);
                            const y = random(canvas.height * 0.5, canvas.height * 0.9);
                            createFirework(x, y);
                        }, i * 300);
                    }
                }
                e.preventDefault();
            }
        });
        
        // æ§åˆ¶æŒ‰é’®äº‹ä»¶
        btnHeart.addEventListener('click', () => {
            fireworkMode = fireworkMode === 'heart' ? 'random' : 'heart';
            updateButtonStates();
        });
        
        btnAuto.addEventListener('click', () => {
            autoFireworks = !autoFireworks;
            updateButtonStates();
        });
        
        btnOsmanthus.addEventListener('click', () => {
            osmanthusEnabled = !osmanthusEnabled;
            updateButtonStates();
            
            if (osmanthusEnabled) {
                // å¼€å§‹æ¡‚èŠ±é£˜è½
                osmanthusInterval = setInterval(createOsmanthus, 500);
            } else {
                // åœæ­¢æ¡‚èŠ±é£˜è½
                clearInterval(osmanthusInterval);
            }
        });
        
        function updateButtonStates() {
            btnHeart.classList.toggle('active', fireworkMode === 'heart');
            btnAuto.classList.toggle('active', autoFireworks);
            btnOsmanthus.classList.toggle('active', osmanthusEnabled);
        }
        
        // éŸ³ä¹æ’­æ”¾æ§åˆ¶
        const musicButton = document.getElementById('music-play-button');
        const backgroundMusic = document.getElementById('background-music');
        
        // å°è¯•è‡ªåŠ¨æ’­æ”¾éŸ³ä¹ï¼ˆå¯èƒ½ä¼šè¢«æµè§ˆå™¨é˜»æ­¢ï¼‰
        window.addEventListener('load', function() {
            backgroundMusic.play().catch(function(error) {
                // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ˜¾ç¤ºæ’­æ”¾æŒ‰é’®
                musicButton.style.display = 'flex';
            });
        });
        
        // ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ—¶æ’­æ”¾éŸ³ä¹å¹¶éšè—æŒ‰é’®
        musicButton.addEventListener('click', function() {
            backgroundMusic.play();
            this.style.display = 'none';
        });
        
        // å¯åŠ¨åŠ¨ç”»
        animate();
        
        // åˆå§‹çƒŸèŠ±
        window.addEventListener('load', () => {
            // é»˜è®¤å¼€å¯è‡ªåŠ¨æ¨¡å¼
            btnAuto.classList.add('active');
            
            // åˆå§‹çƒŸèŠ±æ•ˆæœ
            setTimeout(() => {
                createFirework(canvas.width * 0.2, canvas.height * 0.9);
                fireworkMode = 'heart';
                createFirework(canvas.width * 0.5, canvas.height * 0.85);
                fireworkMode = 'random';
                createFirework(canvas.width * 0.8, canvas.height * 0.9);
            }, 300);
        }, { once: true });
    </script>
</body>
</html>
